# 抓包

|用途|说明|
|---|---|
|网络故障排查|分析网络延迟、丢包、连接问题等。|
|安全分析|检测网络攻击、恶意流量或数据泄露。|
|协议分析|检查网络协议的实现是否符合规范。|
|性能优化|分析网络性能瓶颈，优化数据传输效率。|
|数据包内容检查|查看传输数据的具体内容（如HTTP请求、响应等）。|
|开发调试|调试网络应用程序的请求和响应数据|

可以修改网站数据，相比F12刷新后仍然不变

|工具名称|特点|适用场景|
|---|---|---|
|Wireshark|功能强大，支持多种协议解析，图形化界面友好。|网络分析、协议调试、安全分析|
|Fiddler|专注于HTTP/HTTPS流量抓包，支持请求修改和重放。|Web开发调试、API测试|
|tcpdump|命令行工具，轻量级，适合Linux环境，支持复杂过滤规则。|网络故障排查、协议分析|
|Charles Proxy|支持HTTP/HTTPS抓包，提供丰富的调试功能，适合移动端抓包。|移动应用调试、Web开发|
|Burp Suite|专注于Web安全测试，支持抓包、漏洞扫描和渗透测试。|安全分析、漏洞挖掘|
|Postman|虽然主要是API测试工具，但也支持HTTP请求的抓包和调试。|API开发调试|
|NetworkMiner|专注于被动网络取证分析，支持提取文件和证据。|网络取证、安全分析|

安卓设备

|工具名称|特点|适用场景|
|---|---|---|
|Charles Proxy|支持HTTP/HTTPS抓包，提供证书安装功能，可抓取安卓设备的流量。|安卓应用调试、Web开发|
|Fiddler|通过代理模式抓取安卓设备的HTTP/HTTPS流量，支持请求修改和重放。|安卓应用调试、API测试|
|Packet Capture|安卓端直接安装的抓包工具，无需Root，支持HTTPS解密。|安卓应用流量分析|
|HttpCanary|安卓端抓包工具，支持HTTPS解密和多种协议分析，界面友好。|安卓应用调试、协议分析|
|Burp Suite|专注于安全测试，支持安卓设备的流量抓包和漏洞分析。|安全分析、漏洞挖掘|
|adb logcat|安卓开发工具，虽然不是抓包工具，但可以查看网络请求日志。|开发调试|

1. **HTTPS流量解密**：抓取HTTPS流量时，需要在安卓设备上安装抓包工具生成的自签名证书。
2. **代理配置**：大多数抓包工具需要将安卓设备的网络代理设置为抓包工具所在的电脑IP和端口。
3. **Root权限**：某些工具（如Packet Capture）无需Root即可抓包，但部分高级功能可能需要Root权限。

## windows

### Fiddler

Fiddler 相当于一个 “代理”,浏览器访问浏览器页面时，就会把HTTP请求先发给Fiddler，Fiddler 再把请求转发给浏览器的服务器，当浏览器服务器返回数据时，Fiddler拿到返回数据，再把数据交给浏览器。

[Fiddler Classic](https://www.telerik.com/download/fiddler)
汉化

菜单栏中，Tools——Options
HTTPS：勾选Capture HTTPS CONNECTs、Decrypt HTTPS traffic、Ignore server certificate errors(unsafe)。
接着点击Actions-Export Root Certificate to Desktop，此时桌面上会出现一个文件，我们需要在浏览器edge://settings/privacy/securitySubPage上导入证书（这个文件）
重启Fiddler，就可以抓取HTTPS协议了
Connections：确保fiddler的端口为8888、勾选Allow remote computers to connect
Scripting：自定义脚本语言设置，可以选择C#或者http://Jscript.NET

菜单栏——Rules——Customize Rules，打开规则脚本编辑器，Fiddler ScriptEditor。

**Web Sessions** 窗口
右键——删除——所有会话（快捷键ctrl+X）

|名称|含义|
|---|---|
|#|抓取HTTP Request的顺序，从1开始，以此递增|
|Result|HTTP状态码|
|Protocol|请求使用的协议，如HTTP/HTTPS/FTP等|
|Host|请求地址的主机名|
|URL|请求资源的位置|
|Body|该请求的大小|
|Caching|请求的缓存过期时间或者缓存控制值|
|Content-Type|请求响应的类型|
|Process|发送此请求的进程：进程ID|
|Comments|允许用户为此回话添加备注|
|Custom|允许用户设置自定义值|
|图标|含义|
|![在这里插入图片描述](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731832-1099469999.png)|请求已经发往服务器|
|![在这里插入图片描述](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731709-1201069860.png)|已从服务器下载响应结果|
|![请求从断点处暂停](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731632-176997335.png)|请求从断点处暂停|
|![响应从断点处暂停](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731793-437672330.png)|响应从断点处暂停|
|![请求使用 HTTP 的 HEAD 方法，即响应没有内容（Body）](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731696-455035498.png)|请求使用 HTTP 的 HEAD 方法，即响应没有内容（Body）|
|![请求使用 HTTP 的 POST 方法](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731801-857894193.png)|请求使用 HTTP 的 POST 方法|
|![请求使用 HTTP 的 CONNECT 方法，使用 HTTPS 协议建立连接隧道](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731699-941304435.png)|请求使用 HTTP 的 CONNECT 方法，使用 HTTPS 协议建立连接隧道|
|![响应是 HTML 格式](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731801-1061550609.png)|响应是 HTML 格式|
|![响应是一张图片](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731770-1283493191.png)|响应是一张图片|
|![响应是脚本格式](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731825-1702786816.png)|响应是脚本格式|
|![响应是 CSS 格式](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731839-1114198140.png)|响应是 CSS 格式|
|![响应是 XML 格式](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731694-120993425.png)|响应是 XML 格式|
|![响应是 JSON 格式](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731789-2076784546.png)|响应是 JSON 格式|
|![响应是一个音频文件](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731717-247621893.png)|响应是一个音频文件|
|![响应是一个视频文件](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731833-1548611514.png)|响应是一个视频文件|
|![响应是一个 SilverLight](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731859-1336373275.png)|响应是一个 SilverLight|
|![响应是一个 FLASH](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731711-1944739324.png)|响应是一个 FLASH|
|![响应是一个字体](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731855-1360414423.png)|响应是一个字体|
|![普通响应成功](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731651-963712137.png)|普通响应成功|
|![响应是 HTTP/300、301、302、303 或 307 重定向](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731781-1274467787.png)|响应是 HTTP/300、301、302、303 或 307 重定向|
|![响应是 HTTP/304（无变更）](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731822-669081543.png)|响应是 HTTP/304（无变更）：使用缓存文件|
|![响应需要客户端证书验证](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731829-649992041.png)|响应需要客户端证书验证|
|![服务端错误](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731715-1484719993.png)|服务端错误|
|![会话被客户端、Fiddler 或者服务端终止](https://img2022.cnblogs.com/blog/2699669/202204/2699669-20220411161731821-1144534544.png)|会话被客户端、Fiddler 或者服务端终止|

随意点击一个请求，就可以看到Statistics关于HTTP请求的性能以及数据分析了

Inspectors会话详细
数据已被压缩过了，点击解压

AutoResponder自动转发 允许你拦截指定规则的求情，并返回本地资源或Fiddler资源，从而代替服务器响应。

Composer请求编辑 允许自定义请求发送到服务器，可以手动创建一个新的请求，也可以在会话表中，拖拽一个现有的请求
Parsed模式下你只需要提供简单的URLS地址即可（如下图，也可以在RequestBody定制一些属性，如模拟浏览器User-Agent）

左下角黑框输入命令
Capturing
Web Browers

|命令|对应请求项|介绍|示例|
|---|---|---|---|
|?|All|问号后边跟一个字符串，可以匹配出包含这个字符串的请求|?google|
|>|Body|大于号后面跟一个数字，可以匹配出请求大小，大于这个数字请求|>1000|
|<|Body|小于号跟大于号相反，匹配出请求大小，小于这个数字的请求|<100|
|=|Result|等于号后面跟数字，可以匹配HTTP返回码|=200|
|@|Host|@后面跟Host，可以匹配域名|@www.baidu.com|
|select|Content-Type|select后面跟响应类型，可以匹配到相关的类型|select image|
|cls|All|清空当前所有请求|cls|
|dump|All|将所有请求打包成saz压缩包，保存到“我的文档\Fiddler2\Captures”目录下|dump|
|start|All|开始监听请求|start|
|stop|All|停止监听请求|stop|

断点命令

|bpafter|All|bpafter后边跟一个字符串，表示中断所有包含该字符串的请求|bpafter baidu（输入bpafter解除断点）|
|---|---|---|---|
|bpu|All|跟bpafter差不多，只不过这个是收到请求了，中断响应|bpu baidu（输入bpu解除断点）|
|bps|Result|后面跟状态吗，表示中断所有是这个状态码的请求|bps 200（输入bps解除断点）|
|bpv / bpm|HTTP方法|只中断HTTP方法的命令，HTTP方法如POST、GET|bpv get（输入bpv解除断点）|
|g / go|All|放行所有中断下来的请求|g|

#### 修改网页数据

相比直接使用 **F12 开发者工具** 修改网页，使用 **Fiddler**的优势：
- 刷新页面，修改内容也会保持不变
- 可以拦截和修改动态请求的响应数据，从而影响页面加载的内容。
- 可以修改任何网络请求的响应，包括 JSON 数据、API 响应、图片、文件等。
- 可以拦截和修改任何通过 HTTP/HTTPS 协议传输的数据，包括桌面应用、移动应用等。

Fiddler设置断点，拦截HTTP请求数据，修改HTTP请求数据，然后再请求给服务器端

打全局断点：打开菜单栏——Rules规则---Automatic BreakPoints Before Requests请求前自动断点
设置完成后访问网页会请求不成功
或者点击Fiddler下方阻止图标位置2次

已知URL地址时，这个时候只需对这个URL进行断点调试，其他的请求不拦截
在命令行中输入命令：bpu URL地址  如：bpu www.baidu.com
直接在命令航中输入bpu取消单个断点

点击黄色按钮（Break on Response）会显示响应内容，但是还会继续拦截该网站的请求，浏览器也不会进行跳转
绿色Run to Completion

进行对博客园进行断点拦截
进行请求数据，在Fiddler中继续请求得到响应内容（点击黄色 Break on Response）
修改响应数据内容，再次请求数据（点击绿色Run to Completion）

修改网页的元素，并且刷新依旧不变

在 Fiddler 中，使用 **AutoResponder** 功能来拦截和修改网页的请求。

- 打开 Fiddler，切换到 **AutoResponder** 选项卡。
- 勾选 **Enable rules** 和 **Unmatched requests passthrough**。

- 在浏览器中访问目标网页。
- 在 Fiddler 的 **Web Sessions** 窗口中找到目标网页的请求（通常是 HTML 或 JavaScript 文件）。
- 右键点击目标请求，选择 **Save Response**，将其保存响应数据到本地。（如果被压缩先点击解压缩）
- 使用文本编辑器（如 VS Code）打开保存的文件。
- 修改 HTML 或 JavaScript 文件中的内容，例如更改元素的文本、样式或逻辑。
- 保存修改后的文件。
- - 回到 Fiddler 的 **AutoResponder** 选项卡。
- 点击 **Add Rule**，将目标请求的 URL 映射到你修改后的本地文件。
    - 例如：`http://example.com/index.html` 映射到 `C:\path\to\modified\index.html`。
- 确保规则生效。


[Fiddler] DNS Lookup for "bilipc.bilibili.com" failed. System.Net.Sockets.SocketException 不知道这样的主机。
先关闭捕获，打开应用后再捕获

1. 使用 Fiddler 拦截和修改网络请求
如果目标应用通过网络请求获取数据（例如 API 请求），可以使用 Fiddler 的 AutoResponder 功能拦截并修改这些请求的响应。
2. 使用内存修改工具
如果目标应用的数据存储在内存中，可以使用内存修改工具（如 Cheat Engine）直接修改内存中的数据。
3. 使用 Hook 技术
通过 Hook 技术拦截目标应用的函数调用或系统 API 调用，修改其行为或数据。
4. 修改本地文件
如果目标应用的数据存储在本地文件中（例如配置文件、数据库文件等），可以直接修改这些文件。
5. 使用逆向工程
如果需要更深入的修改，可以通过逆向工程分析目标应用的代码并修改其逻辑。

## 安卓

### Fiddler代理模式

### HttpCanary

# 微型计算机

接口：位于主机与外设之间的一些转换电路的总称（最基本的功能是输入缓冲和输出锁存）
I/O：主机与外设之间的数据传送。
总线：一组性质相似的信号的总和，计算机各模块间信号传输的公共通道（地址AB、数据DB、控制CB）
端口：一个I/O地址称为一个端口（8086有2^16个）

## 微处理器

运算器+控制器

### 8088/8086 CPU

作为IBM PC/XT 微型计算机的微处理器
8088数据总线宽度为8位，8086数据总线宽度为16位。除此之外两者几乎没有区别。

#### 8088外部引脚

最小模式:用于由8088**单一微处理器**构成的小系统。在这种方式下，由8088CPU直接产生小系统所需要的全部控制信号。
最大模式:用于实现 **多处理机系统，** 系统控制总线由8088和总线控制器8288共同构成。在这种方式下，8088CPU不直接提供用于存储器或I/O读写的读写命令等控制信号，而是将当前要执行的传送操作类型编码为3个状态位输出，由总线控制器8288对状态信号进行译码产生相应控制信号。

这张是8088最大模式和最小模式的合图。

![](https://img2020.cnblogs.com/blog/1986811/202004/1986811-20200424212105821-1524083319.png)

下面是最大模式和最小模式一样的引脚含义：

1. AD7～AD0：8088 地址/数据分时复用总线（address/data bus），双向，三态。
   > 根据不同时钟周期的要求，决定当前是传送要访问的存储单元或I/O端口的低16位地址，还是传送16位数据，或是处于高阻状态。
   >
2. A15～A8：8 位地址信号，输出，三态。在整个总线周期内提供存储器高 8 位地址。
3. A19/S6～A16/S3：分时复用地址/状态总线（address/status bus），输出，三态。提供地址信号A19～A16 (20位地址总线的高4位地址 ) 及状态位 S6～S3。
   > S6=0，表示S6～S3当前表示的是状态位 ，S6=1，则表示当前表示的是地址
   > S5指示当前中断允许标志IF的状态。
   > S4，S3的代码组合用来指明当前正在使用的段寄存器。S4，S3的代码组合及对应段寄存器的情况。
   > S4S3 = 00->ES; 01->SS; 10->CS; 11->DS
   >
4. INTR： 中断请求（interrupt request）信号，输入，用来申请一个硬件中断。
   > 当 IF=1 时，若 INTR 保持高电平，则 8088 在当前指令执行完毕后就进入中断响应周期（INTA ̅̅̅̅̅̅̅变为有效）。
   >
5. NMI： 非屏蔽中断（non-maskable interrupt）输入信号。与 INTR 信号类似，但 NMI 中断不必检查 IF 标志位是否为 1。
6. RD ̅̅̅̅： 读信号，输出，三态。当它为低电平时，CPU 通过数据总线接收来自存储器或 I/O设备的数据。
7. READY：准备就绪信号，输入，高电平有效。 当READY信号高电平有效时，表示CPU要访问的存储器或I/O端口已经作好了输入/输出数据的准备工作 。
8. TEST：等待测试控制信号，输入，低电平有效，CPU进入等待状态。
   > 信号用来支持构成多处理器系统，实现8086CPU与协处理器之间同步协调的功能，只有当CPU执行WAIT指令时才使用。
   >
9. RESET：复位信号，输入，高电平有效。
   > RESET信号有效时，CPU立即结束现行操作，处于复位状态，初始化所有的内部寄存器为0000H（包括DS、SS、ES、IP、FLAGS和其余寄存器），并把指令队列置空，注意CS代码段寄存器置为FFFFH。复位后各内部寄存器的状态，当RESET信号由高电平变为低电平时，CPU从FFFF0H地址开始重新启动执行程序。
   >
10. CLK：时钟信号，输入。CLK为CPU提供基本的定时脉冲信号。
11. VCC电源输入引脚。
12. GND：接地引脚。

最小模式下

![](https://img2020.cnblogs.com/blog/1986811/202004/1986811-20200424212029264-1820787939.png)

当MN/MX=1，即引脚接高电平时，CPU工作于最小模式。此时，引脚信号24～31的含义及其功能如下：

1. HOLD：总线保持请求信号，输入，高电平有效。
   > 在DMA数据传送方式中，由总线控制器8237A发出一个高电平有效的总线请求信号，通HOLD引脚输入到CPU，请求CPU让出总线控制权。
   >
2. HLDA（holdacknowledge）：总线保持响应信号，输出，高电平有效。
   > HLDA是与HOLD配合使用的联络信号。在HLDA有效期间，HLDA引脚输出一个高电平有效的响应信号，同时总线将处于浮空状态，CPU让出对总线的控制权，将其交付给申请使用总线的8237A控制器使用，总线使用完后，会使HOLD信号变为低电平，CPU又重新获得对总线的控制权。
   >
3. WR ̅̅̅̅̅： 写选通信号，输出，三态。指示 8086/8088 正在输出数据给存储器或 I/O 设备。在WR ̅̅̅̅为低电平期间，数据总线包含给存储器或 I/O 设备的有效数据。
4. IO/M ̅： 输出，三态。该引脚选择存储器或 I/O 端口，即微处理器地址总线是存储器地址还是 I/O 端口地址。 为高电平时，访问存储器；为低电平时，访问I/O端口 。
5. DT/R：数据发送/接收信号，输出，三态。
   > DT/R信号用来控制数据传送的方向。DT/R为高电平时，CPU发送数据到存储器或I/O端口；DT/R为低电平时，CPU接收来自存储器或I/O端口的数据。
   >
6. DEN：数据允许控制信号，输出，三态，低电平有效。信号用作总线收发器的选通控制信号。当为低电平时，表明CPU进行数据的读/写操作。
7. ALE：地址锁存允许信号，输出，高电平有效。
   > CPU利用ALE信号可以把AD15～AD0地址/数据、A19/S6～A16/S3地址/状态线上的地址信息锁存在地址锁存器中。
   >
8. INTA：可屏蔽中断响应信号，输出，低电平有效。
   > CPU通过信号对外设提出的可屏蔽中断请求做出响应。为低电平时，表示CPU已经响应外设的中断请求，即将执行中断服务程序。
   >

最大模式下

当MN/MX直接接地就以最大模式下工作

![](https://img2020.cnblogs.com/blog/1986811/202004/1986811-20200424212045450-686049398.png)

1. RQ/，GT：总线请求允许信号输入/总线请求允许输出信号，双向，低电平有效。
   > 该信号用以取代最小模式时的HOLD/HLDA两个信号的功能，是特意为多处理器系统而设计的。
   >
   > 当系统中某一部件要求获得总线控制权时，就通过此信号线向8086CPU发出总线请求信号，若CPU响应总线请求，就通过同一引脚发回响应信号，允许总线请求，表明8086CPU已放弃对总线的控制权，将总线控制权交给提出总线请求的部件使用。
   >
   > RQ/GT0优先级高于RQ/GT1。
   >
2. LOCK：总线封锁信号，输出，低电平有效。信号有效时，表示此时8086CPU不允许其他总线部件占用总线。（相当于INTA）
3. S2，S1，S0：总线周期状态信号，输出，低电平有效。
4. QS1，QS0：指令队列状态信号，输出。
   > QS1和QS0信号的组合可以指示总线接口部件BIU中指令队列的状态，以便其他处理器监视、跟踪指令队列的状态。
   >
   > 00->队列空闲；01->表明操作码的第一个字节；10->队列空；表明11->操作码的后续字节
   >
   > 最小模式下不需要这两个引脚是因为单一微处理器EU 执行指令和 BIU 取指令 **不能同时进行** ，也就没有指令队列
   >

#### 8088/8086工作时序

## I/O接口读写

地址信号在地址总线上保持到本指令结束
RD/WD/CS/MI0低电平有效;BHE高电平有效

if >FFH DX

```assm
MOV DX,开关地址
IN AL,DX

MOV AL,0
MOV DX,二极管地址
OUT DX,AL
```

### 接口编址

I/O端口的编址方法分为：存储器映射编址（统一编址）、I/O映射编址（独立编址）

8086系列微机采用I/O映射编址

#### 译码器74LS138编址

有N个地址没用到，产生2^n个重叠地址

#### 数字比较器74LS520编址

使用数字比较器给外设编址，外设的地址可以在一定范围内随意设置；而用译码器给外设编址是固定的

### 基本输入输出方式

1. 程序控制的I/O方式
   - 无条件I/O方式
   - 查询I/O方式
2. 程序中断的I/O方式（断电不算中断）
3. 直接存储器R/W方式（DMA方式）

```assm
;查询输入
        MOV DX,STATUS
NEXT:   IN AL,DX
        TEST AL,1
        JZ NEXT
        MOV DX,DATA
        IN AL,DX

;查询输出
        MOV DX,STATUS
NEXT:   IN AL,DX
        TEST AL,1
        JNZ NEXT
        MOV AL,0
        MOV DX,DATA
        OUT DX,AL
```

## 常用数字接口电路

并行通信、串行通信
同步通信、异步通信

### 并行接口芯片8255A

```assm
;设计一个并行接口电路，使输出端控制8个发光二极管。编程实现循环发光
        MOV DX,PORT
        MOV AL,0FEH
NEXT:   OUT DX,AL
        CALL DELAY1
        ROL AL,1    ;循环左移
        JMP NEXT
```

8355A的方式控制字

## 模拟量的输入输出

### A/D转换 ADC0809

模/数转换，原理将模拟电压成正比地转换为数字量

并联比较型
逐次逼近型
双积分型

指标：分辨率、转换速率、线性度

```assm
    OUT 50H,AL  ;选IN0启动A/D转换
W:  IN AL,41H   ;输入EOC标志
    TEST AL,01H
    JZ W        ;返回等待
    IN AL,49H   ;结束，结果送入AL
```

### D/A转换 DAC0832

数/模转换

权电阻转换法
T型电阻网络转换法

指标：分辨率、建立时间、精度、线性度

```assm
;从ADC0809的IN0端输入一个可调模拟电压，经A/D转换后，将数字量读入CPU中
;然后将该数字量送至DAC0832转换成模拟电压输出

        MOV DX,200H
        MOV AL,0
        OUT DX,AL
  
        MOV DX,208H
ADDR2:  IN AL,DX
        TEST AL,1
        JZ ADDR2
        MOV DX,200H
        IN AL,DX
        MOV DX,210H
        OUT DX,AL
```

## 人机交互

### 微机键盘

行扫描法（8255A）：

1. 首先让8255A A口输出扫描码（初始为11111110B）
2. 程序读入8255A B口状态，判定是否有为逻辑0的列线
   - 若B口有0的位，说明本行有键被按下，经移位检测从为0的列线序列号，与扫描码为0位对应的行线序号共同组成键号，转相应键处理程序
   - 若B口没有0的位，说明本行没有键被按下，修改扫描码（下一次为11111101B）
3. 回到第一步，进行下一次扫描，如此循环直到发现有键被按下

### LED显示

数码管
字型码

# 最优化基础

前置知识：线性代数、多元函数分析、凸集与凸函数

一阶导数或梯度
二阶导数或Hesse矩阵
向量函数的一阶导数或Jacobi矩阵

定义 凸集 设集合 $D\subset\mathbb{R}^{n}$ ，如果对任意的 $\boldsymbol{x,y}\in D$ 与任意的 $\alpha\in[0,1]$ ，有 $\alpha \boldsymbol{x}+(1-\alpha)\boldsymbol{y}\in D$ ，则称该集合为凸集
几何意义是：若两个点属于集合，则这两点连线上的任意一点均属于此集合
凸集的内点集合为 $\text{int}D$ ；边界点集合为 $\partial D$ ；包含集合的最小闭集闭包 $\text{cl}D=D\bigcup \partial D$

**投影定理** 设 $D\subset\mathbb{R}^{n}$ 是非空闭凸集，$\boldsymbol{y}\in \mathbb{R}^{n},\boldsymbol{y}\notin D$，则存在唯一的点 $\overline{\boldsymbol{x}}\in D$ ，使得 $\overline{\boldsymbol{x}}$ 是 $\boldsymbol{y}$ 到 $D$ 的距离最小的点，且充要条件是 $(\boldsymbol{x}-\overline{\boldsymbol{x}})^{T}(\overline{\boldsymbol{x}}-\boldsymbol{y})\geqslant 0,\forall \boldsymbol{x}\in D$

**分离定理** 设 $D\subset\mathbb{R}^{n}$ 是非空闭凸集，$\boldsymbol{y}\in \mathbb{R}^{n},\boldsymbol{y}\notin D$，则存在非零向量 $\boldsymbol{\alpha}\in \mathbb{R}^{n},\beta\in R$ ，满足 $\boldsymbol{\alpha}^{T}\boldsymbol{x}\leq\beta<\boldsymbol{\alpha}^{T}\boldsymbol{y},\forall \boldsymbol{x}\in D$。即存在超平面 $H=\{\boldsymbol{x}\in \mathbb{R}^{n}|\boldsymbol{\alpha}^{T}\boldsymbol{x}=\beta\}$ 严格分离 $\boldsymbol{y}$ 与 $D$

**支撑超平面定理** 设 $D\subset\mathbb{R}^{n}$ 是非空闭凸集， $\overline{\boldsymbol{x}}\in \partial D$ ，则存在非零向量 $\boldsymbol{\alpha}\in \mathbb{R}^{n}$，使得 $\boldsymbol{\alpha}^{T}\boldsymbol{x}\leq\boldsymbol{\alpha}^{T}\overline{\boldsymbol{x}},\forall \boldsymbol{x}\in\text{cl}D$。
此时称 $H=\{\boldsymbol{x}\in \mathbb{R}^{n}|\boldsymbol{\alpha}^{T}\boldsymbol{x}=\boldsymbol{\alpha}^{T}\overline{\boldsymbol{x}}\}$ 为集合 $D$ 在点 $\overline{\boldsymbol{x}}$ 处的支撑超平面

**最优化问题**数学模型的一般形式为：其中 $\min$ 表示极小值（极大值 $\max{f(x)}=\min{(-f(x))}$）， $s.t.$ 表示受限制于(subject to)


$$
\begin{align}
&\min{f(\boldsymbol{x})};\\
s.t.\ \ &c_{i}(\boldsymbol{x}) =0, i\in E=\{1,\cdots,l\},\\
&c_{i}(\boldsymbol{x})\leqslant 0, i\in I=\{l+1,\cdots,l+m\}, \\
&\boldsymbol{x}\in \mathbb{R}^{n}.
\end{align}
$$

称 $f(\boldsymbol{x})$ 为问题的**目标函数**；$c_{i}(x)\ (i\in E\cup I)$ 为问题的**约束函数**；称 $D=\{\boldsymbol{x}|c_{i}(\boldsymbol{x}) =0, i\in E;c_{i}(\boldsymbol{x})\leqslant 0, i\in I\}$ 为问题的**可行域**

**定义 `局部解、全局解`**
对于约束规划问题，若对 $\boldsymbol{x}^{*}\in D$，存在 $\varepsilon>0$，使得当 $\boldsymbol{x}\in D,0<||\boldsymbol{x}-\boldsymbol{x}^{*}||\leqslant\varepsilon$ 时，总有 $f(\boldsymbol{x})\geqslant f(\boldsymbol{x}^{*})$ ，则称 $\boldsymbol{x}^{*}$ 为问题的**局部解**。如果总有 $f(\boldsymbol{x})> f(\boldsymbol{x}^{*})$ ，则称为**严格局部解**。
对于约束规划问题，若对 $\boldsymbol{x}^{*}\in D$，当 $\boldsymbol{x}\in D,\boldsymbol{x}\ne\boldsymbol{x}^{*}$ 时，总有 $f(\boldsymbol{x})\geqslant f(\boldsymbol{x}^{*})$ ，则称 $\boldsymbol{x}^{*}$ 为问题的**全局解**。如果总有 $f(\boldsymbol{x})> f(\boldsymbol{x}^{*})$ ，则称为**严格全局解**。


## 无约束最优化问题

### 无约束规划的最优性条件

* **一阶必要条件**：设 $f(\boldsymbol{x})$ 一阶连续可微，若 $\boldsymbol{x}^{*}$ 是无约束问题的一个局部解，则 $\nabla f(\boldsymbol{x}^{*})=\boldsymbol{0}$
* **二阶必要条件**：设 $f(\boldsymbol{x})$ 二阶连续可微，若 $\boldsymbol{x}^{*}$ 是无约束问题的一个局部解，则 $\nabla f(\boldsymbol{x}^{*})=\boldsymbol{0},\ \nabla^{2}f(\boldsymbol{x}^{*})$ 为半正定
* **二阶充分条件**：设 $f(\boldsymbol{x})$ 二阶连续可微，$\nabla f(\boldsymbol{x}^{*})=\boldsymbol{0},\ \nabla^{2}f(\boldsymbol{x}^{*})$ 为正定，则 $\boldsymbol{x}^{*}$ 是无约束问题的一个严格局部解
* **凸充分定理**：若 $f:\mathbb{R}^{n}\to\mathbb{R}$ 是凸函数，且 $f(\boldsymbol{x})$ 一阶连续可微，则 $\boldsymbol{x}^{*}$ 是全局解的充要条件是 $\nabla f(\boldsymbol{x}^{*})=\boldsymbol{0}$

### 无约束规划的下降算法

求解无约束问题的关键是构造一系列序列 $\{\boldsymbol{x}^{k}\}$ ，满足$\displaystyle\lim_{ k \to \infty }f(\boldsymbol{x}^{k})=f(\boldsymbol{x}^{*})=\min_{\boldsymbol{x}\in \mathbb{R}^{n}}f(\boldsymbol{x}),\lim_{ k \to \infty }\boldsymbol{x}^{k}=\boldsymbol{x}^{*}$
称 $\{\boldsymbol{x}^{k}\}$ 为极小化点列。极小化点列一般采取逐步构造法 $\boldsymbol{x}^{k+1}=\boldsymbol{x}^{k}+a_{k}\boldsymbol{d}^{k}$ ，其中 $\boldsymbol{d}^{k}$ 称为 $\boldsymbol{x}^{k}$ 处的搜索方向， $a_{k}$ 为沿方向 $\boldsymbol{d}^{k}$ 的步长

**下降算法**的一般迭代格式：
（1）给定初始点 $\boldsymbol{x}^{1},k:=1$
（2）确定局部下降方向 $\boldsymbol{d}^{k}$ ，使得 $\nabla f(\boldsymbol{x}^{k})^{T}\boldsymbol{d}^{k}<\boldsymbol{0}$
（3）确定步长 $\alpha_{k}>0$ ，使得 $f(\boldsymbol{x}^{k}+\alpha_{k}\boldsymbol{d}^{k})<f(\boldsymbol{x}^{k})$
（4）令 $\boldsymbol{x}^{k+1}=\boldsymbol{x}^{k}+\alpha_{k}\boldsymbol{d}^{k}$
（5）若 $\boldsymbol{x}^{k+1}$ 满足终止准则，则停；否则，令 $k:=k+1$，转步骤（1）

* 确定某点出的搜索方向：各种不同的算法
* 确定该方向上的步长：进行一维搜索
* 确定当前点的终止准则：与算法有关，常用的终止准则是 $\nabla f(\boldsymbol{x}^{k+1})^{T}\boldsymbol{d}^{k}=\boldsymbol{0}$

**定义 `局部/全局收敛`** 只有当初始点靠近极小点时才能保证极小化点列收敛到极小点的算法称为局部收敛；任意的初始点都能保证极小化点列收敛到极小点的算法称为全局收敛

**定义 `收敛速度`** 设序列 $\{\boldsymbol{x}^{k}\}$ 收敛到 $\boldsymbol{x}^{*}$ ，若极限 $\displaystyle\lim_{ k \to \infty }\frac{||\boldsymbol{x}^{k+1}-\boldsymbol{x}^{*}||}{||\boldsymbol{x}^{k}-\boldsymbol{x}^{*}||}=\beta$ 存在，
当 $0<\beta<1$ 时 ，称 $\{\boldsymbol{x}^{k}\}$ 为线性收敛；当 $\beta=0$ 时 ，称为超线性收敛；当 $\beta=1$ 时 ，称为次线性收敛，次线性收敛收敛速度太慢，一般不考虑
特别地，超线性收敛中，对于 $p>1$，若极限 $\displaystyle\lim_{ k \to \infty }\frac{||\boldsymbol{x}^{k+1}-\boldsymbol{x}^{*}||}{{||\boldsymbol{x}^{k}-\boldsymbol{x}^{*}||}^{p}}=\beta<+\infty$ ，则称为p阶收敛

**定义 `二次终止性`** 设 $\boldsymbol{G}$ 是正定对称矩阵，称函数  $f(\boldsymbol{x})=\dfrac{1}{2}\boldsymbol{x}^{T}\boldsymbol{Gx}+\boldsymbol{r}^{T}\boldsymbol{x}+\delta$为正定二次函数
若某个算法对于任意的正定二次函数，从任意的初始点出发，都能经过有限步迭代到其极小点，则称该算法具有二次终止性

为了使极小化序列能够收敛到一个平稳点，这就对下降方向和步长提出了要求。
**下降方向**：存在 $\overline{u}>0$，使得 $\boldsymbol{d}^{k}$ 与 $-\nabla f(\boldsymbol{x}^{k})$ 之间的夹角 $\theta_{k}$ 满足 $\theta_{k}\leq\dfrac{\pi}{2}-\overline{u},\ \forall k$

#### 无约束规划方法

##### 最速下降法（梯度法）

设目标函数 $f(\boldsymbol{x})$ 在 $\boldsymbol{x}^{k}$ 附近连续可微，且 $\nabla f(\boldsymbol{x}^{k})\ne \boldsymbol{0}$ 。将 $f(\boldsymbol{x})$ 在 $\boldsymbol{x}^{k}$ 处按照泰勒级数展开，并令 $\boldsymbol{x}=\boldsymbol{x}^{k}+\alpha \boldsymbol{d}^{k}$

$$
f(\boldsymbol{x}^{k}+\alpha \boldsymbol{d}^{k})=f(\boldsymbol{x}^{k})+\alpha \nabla f(\boldsymbol{x}^{k})^{T}\boldsymbol{d}^{k}+o(||\alpha \boldsymbol{d}^{k}||)
$$

可知 $-\nabla f(\boldsymbol{x}^{k})^{T}\boldsymbol{d}^{k}$ 越大，则 $f(\boldsymbol{x})$ 下降的幅度就越大。由：

$$
-\nabla f(\boldsymbol{x}^{k})^{T}\boldsymbol{d}^{k}=||\nabla f(\boldsymbol{x}^{k})||\ ||\boldsymbol{d}^{k}||\ \cos\theta_{k}
$$

故**取搜索方向** $\boldsymbol{d}^{k}=-\nabla f(\boldsymbol{x}^{k})$ 的方法称为**最速下降法**

##### Newton法

利用Newton法求解最优化问题，优点是收敛速度快，缺点是不能保证每一步总是下降的并且当Hesse矩阵奇异是无法计算。

##### 共轭梯度法（FR法、PRP法）

共轭梯度法

#### 线性搜索

假设搜索方向 $\boldsymbol{d}^{k}$ 已经确定，寻找沿方向的合适的步长  $a_{k}$ 称为一维搜索问题

设 $\phi(\alpha)=f(\boldsymbol{x}^{k}+\alpha \boldsymbol{d}^{k})$

##### 精确线性搜索

 如果有 $\alpha_{k}$ ，使得 $\displaystyle\phi(\alpha_{k})=\min_{\alpha\geq_{0}}\{\phi(\alpha)=f(\boldsymbol{x}^{k}+\alpha \boldsymbol{d}^{k})\}$ ，则称该搜索为精确线性搜索，称 $\alpha_{k}$ 为最优步长
 由最优解的必要条件知，是方程的非负根。可利用[[../计算数学/数值计算|数值计算]]中非线性方程求根法求解
 通常求方程的全局极小点是困难的，故通常取方程的最小正根最为的极小点，这就是**Curry准则**

 $$
\alpha_{k}=\min\{\alpha>0|\nabla f(\boldsymbol{x}^{k}+\alpha \boldsymbol{d}^{k})^{T}\boldsymbol{d}^{k}=\boldsymbol{0}\}
$$

##### 直接搜索——0.618法

定义 `搜索区间` 设 $\alpha^{*}$ 是 $\phi(\alpha)$ 的极小点，若存在区间 $[a,b]$ ，使得 $\alpha^{*}\in[a,b]$ ，则称 $[a,b]$ 为 $\phi(\alpha)$ 的搜索区间

定义 `单峰函数`

**0.618法**：
已知初始搜索区间 $[a,b]$ ，并且函数 $\phi(\alpha)$ 在搜索区间上是单峰函数
记 $\tau=\dfrac{\sqrt{5}-1}{2}\approx 0.618$ 是方程 $\tau^{2}+\tau-1=0$ 的根

1. 取左试探点为 $a_{l}=a+(1-\tau)(b-a)$
右试探点为 $a_{r}=a+\tau(b-a)$
并分别计算函数值 $\phi_{l}=\phi(a_{l}),\phi_{r}=\phi(a_{r})$
2. 若 $\phi_{l}<\phi_{r}$ ，令 $a'=a,b'=a_{r}$ ，得到一个新的搜索区间 $[a,a_{r}]$
若 $\phi_{l}>\phi_{r}$ ，令 $a'=a_{l},b'=b$ ，得到一个新的搜索区间 $[a_{l},b]$
对这个新的搜索区间 $[a',b']$ 重复进行上述操作直至：
3. 如果搜索区间长度小于给定精度，则取函数值较小的试探点为问题的解

（取 $\tau$ 为黄金分割的原因是对新的搜索区间重新取试探点时只用计算一个，因为另一个试探点是原搜索区间的一个试探点）

##### 非精确一维搜索

使用精确线性搜索和0.618法求得的步长虽然使目标函数在每次迭代中下降较多，但是计算量大
而在求目标函数最优解时，没必要十分精确的线性搜索。特别是在计算的初始阶段，迭代点离最优解尚远
因此可以适当放松对每一步步长的要求，只要求目标函数在迭代的每一步有充分的下降即可（步长太大点列不稳定；步长太小收敛太慢）

**Goldstein方法**
预先指定两个满足精度的参数（$0<\beta_{1}<\beta_{2}<1$），步长 $\mu$ 满足：

$$
\begin{align}
&\phi(\mu)\leqslant \phi(0)+\mu\beta_{1}\phi'(0) \\
&\phi(\mu)\geqslant \phi(0)+\mu\beta_{2}\phi'(0)
\end{align}
$$

**Armijo方法**
预先指定一个大于1的数 $M$ （通常取2~10）和 $0<\beta_{1}<1$，步长 $\mu$ 满足：

$$
\begin{align}
&\phi(\mu)\leqslant \phi(0)+\mu\beta_{1}\phi'(0) \\
&\mu\leqslant M
\end{align}
$$

**Wolfe-Powell方法**
预先指定两个满足精度的参数（$0<\beta_{1}<\beta_{2}<1$），步长 $\mu$ 满足：

$$
\begin{align}
&\phi(\mu)\leqslant \phi(0)+\mu\beta_{1}\phi'(0) \\
&\phi'(\mu)\geqslant\beta_{2}\phi'(0)
\end{align}
$$

该方法优点在于在可接受解中保证了最优解

## 约束最优化问题

### 约束规划的最优性条件

* **一阶必要条件**：
	* 若 $\boldsymbol{x}^{*}$ 是约束问题的局部解，则 $\text{FD}^{*}\bigcap\text{DD}^{*}=\varnothing$

**二阶充分条件**
 **凸规划的最优性条件**

### 约束规划的对偶理论

如果原问题是非凸问题，那么将无有效的算法求解出它的全局解。一个顺其自然的想法就是构造一个与原问题紧密的问题，并且这个问题本身就很简单，而这个简单的问题就是对偶问题
通过对偶问题可以得到原问题最优解的下界

#### Lagrange对偶问题

考虑如下约束规划问题：其中 $X$ 是由简单约束条件所定义的集合，如 $X=\{\boldsymbol{x}\in \mathbb{R}^{n}|\boldsymbol{x}\geq_{0}\}$

$$
\begin{align}
&\min{f(\boldsymbol{x})};\\
s.t.\ \ &c_{i}(\boldsymbol{x}) =0, i\in E=\{1,\cdots,l\},\\
&c_{i}(\boldsymbol{x})\leqslant 0, i\in I=\{l+1,\cdots,l+m\}, \\
&\boldsymbol{x}\in X.
\end{align}
$$

称该问题为**原问题** $(P)$，引入**Lagrange函数**： $\displaystyle L(\boldsymbol{x},\boldsymbol{\lambda})=f(\boldsymbol{x})+\sum_{i=1}^{l+m}\lambda_{i}c_{i}(\boldsymbol{x})$
定义**对偶函数**：$\displaystyle d(\boldsymbol{\lambda})=\text{inf}\{f(\boldsymbol{x})+\sum_{i=1}^{l+m}\lambda_{i}c_{i}(\boldsymbol{x})|x\in X\}$
定义**对偶问题** $(D)$：

$$
\begin{align}
&\max{d(\boldsymbol{\lambda})}; \\
s.t.\ \ &\lambda_{i}\geqslant 0,i\in I
\end{align}
$$

原命题可表示为：$\min_\limits{\boldsymbol{x}\in X} \max_\limits{\lambda_{i} \geq 0} L(\boldsymbol{x},\boldsymbol{\lambda})$
对偶命题可表示为：$\max_\limits{\lambda_{i} \geq 0}\min_\limits{\boldsymbol{x}\in X}  L(\boldsymbol{x},\boldsymbol{\lambda})$

#### 对偶定理

定义 对偶间隙 原问题 $(P)$ 的最优值 $v(P)$ 和对偶问题 $(D)$ 的最优值 $v(D)$ 的差，即 $v(P)-v(D)$

**弱对偶定理**：`对偶间隙大于0`，即 $\min\{f(\boldsymbol{x})|\boldsymbol{x}\in D\}\geq\max\{d(\boldsymbol{\lambda})|\lambda_{i}\geq 0,i\in I\}$
另一种表述：设 $\overline{\boldsymbol{x}}$ 是原问题的可行解，$\overline{\boldsymbol{\lambda}}$ 是其对偶问题的可行解，则 $f(\overline{\boldsymbol{x}})>d(\overline{\boldsymbol{\lambda}})$

**强对偶定理**：设集合 $X$ 为非空凸集，$f(\boldsymbol{x}),c_{i}(\boldsymbol{x})(i\in I)$ 是凸函数， $c_{i}(\boldsymbol{x})(i\in E)$ 均为线性函数。假设存在 $\hat{\boldsymbol{x}}\in X$ 使得 $c_{i}(\hat{\boldsymbol{x}})=0(i\in E),c_{i}(\hat{\boldsymbol{x}})<0(i\in I)$ ，且 $\boldsymbol{0}\in\text{int}S(X)$，则`对偶间隙为0`
其中 $S(X)=\{(c_{1}(\boldsymbol{x}),\cdots,c_{l}(\boldsymbol{x}))^{T}|\boldsymbol{x}\in X\}$，int指集合内部 （不包括边界）

#### 对偶问题的求解

### 约束规划的求解方法

#### 外罚函数法

#### 内罚函数法

#### 乘子法

### 线性规划

### 二次规划

### 特殊规划

#### 几何规划

#### 多目标规划
